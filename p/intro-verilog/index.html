<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="Verilog HDL（简称 Verilog ）是一种硬件描述语言，用于数字电路的系统设计。可对算法级、门级、开关级等多种抽象设计层次进行建模。Verilog 继承了 C 语言的多种操作符和结构，与另一种硬件描述语言 VHDL 相比，语法不是很严格，代码更加简洁，更容易上手。Verilog 不仅定义了语法，还对语法结构都定义了清晰的仿真语义。">
<title>Intro Verilog</title>

<link rel='canonical' href='https://echudet.github.io/p/intro-verilog/'>

<link rel="stylesheet" href="/scss/style.min.86fc5e5efb829fb1bdd7a2d2275017fb3ae01ba7fcf491e347d76495ae5e3ae2.css"><meta property='og:title' content="Intro Verilog">
<meta property='og:description' content="Verilog HDL（简称 Verilog ）是一种硬件描述语言，用于数字电路的系统设计。可对算法级、门级、开关级等多种抽象设计层次进行建模。Verilog 继承了 C 语言的多种操作符和结构，与另一种硬件描述语言 VHDL 相比，语法不是很严格，代码更加简洁，更容易上手。Verilog 不仅定义了语法，还对语法结构都定义了清晰的仿真语义。">
<meta property='og:url' content='https://echudet.github.io/p/intro-verilog/'>
<meta property='og:site_name' content='echudet'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2024-11-20T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-11-20T22:49:13&#43;08:00'/><meta property='og:image' content='https://echudet.github.io/p/intro-verilog/bg.png' />
<meta name="twitter:title" content="Intro Verilog">
<meta name="twitter:description" content="Verilog HDL（简称 Verilog ）是一种硬件描述语言，用于数字电路的系统设计。可对算法级、门级、开关级等多种抽象设计层次进行建模。Verilog 继承了 C 语言的多种操作符和结构，与另一种硬件描述语言 VHDL 相比，语法不是很严格，代码更加简洁，更容易上手。Verilog 不仅定义了语法，还对语法结构都定义了清晰的仿真语义。"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://echudet.github.io/p/intro-verilog/bg.png' />
    <link rel="shortcut icon" href="/timer.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu11199958555974308744.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">⌨️</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">echudet</a></h1>
            <h2 class="site-description">探索编程的学生一枚</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/EchudeT'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>主页</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>关于</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>档案</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>搜索</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>暗色模式</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#verliog知识点">Verliog知识点</a>
      <ol>
        <li><a href="#verilog-数据类型">Verilog 数据类型</a></li>
        <li><a href="#verilog-操作符分类表">Verilog 操作符分类表</a></li>
        <li><a href="#verilog-数值表示">Verilog 数值表示</a></li>
        <li><a href="#verilog-状态机">Verilog 状态机</a></li>
        <li><a href="#verilog-竞争与冒险">Verilog 竞争与冒险</a></li>
        <li><a href="#testbench-概述">Testbench 概述</a></li>
        <li><a href="#语法补充">语法补充</a></li>
        <li><a href="#verilog-hdl的设计层次与风格">Verilog HDL的设计层次与风格</a></li>
        <li><a href="#编程建议与经验">编程建议与经验</a></li>
      </ol>
    </li>
    <li><a href="#verilog的实战引入">Verilog的实战引入</a>
      <ol>
        <li><a href="#示例程序4位二进制计数器">示例程序：4位二进制计数器</a></li>
        <li><a href="#4位二进制计数器testbench">4位二进制计数器testbench</a></li>
        <li><a href="#示例程序交通信号灯控制">示例程序：交通信号灯控制</a></li>
        <li><a href="#示例程序uart的收发">示例程序：UART的收发</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/intro-verilog/">
                <img src="/p/intro-verilog/bg_hu12508700308876493309.png"
                        srcset="/p/intro-verilog/bg_hu12508700308876493309.png 800w, /p/intro-verilog/bg_hu5120343208905150860.png 1600w"
                        width="800" 
                        height="600" 
                        loading="lazy"
                        alt="Featured image of post Intro Verilog" />
                
            </a>
        </div>
    

    <div class="article-details">


    
    <header class="article-category">
        
            <a href="/categories/verilog/" >
                Verilog
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/intro-verilog/">Intro Verilog</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            Verilog HDL（简称 Verilog ）是一种硬件描述语言，用于数字电路的系统设计。可对算法级、门级、开关级等多种抽象设计层次进行建模。Verilog 继承了 C 语言的多种操作符和结构，与另一种硬件描述语言 VHDL 相比，语法不是很严格，代码更加简洁，更容易上手。Verilog 不仅定义了语法，还对语法结构都定义了清晰的仿真语义。
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-11-20</time>
            </div>
        

        
            <div>
                <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="792px" height="792px" viewBox="0 0 792 792" style="enable-background:new 0 0 792 792;" xml:space="preserve">
<g>
	<g id="_x31_0_19_">
		<g>
			<path d="M643.5,742.5H594V569.25C594,473.566,516.434,396,420.75,396C516.434,396,594,318.434,594,222.75V49.5h49.5
				c13.662,0,24.75-11.088,24.75-24.75S657.162,0,643.5,0h-495c-13.662,0-24.75,11.088-24.75,24.75S134.838,49.5,148.5,49.5H198
				v173.25C198,318.434,275.566,396,371.25,396C275.566,396,198,473.566,198,569.25V742.5h-49.5c-13.662,0-24.75,11.088-24.75,24.75
				S134.838,792,148.5,792h495c13.662,0,24.75-11.088,24.75-24.75S657.162,742.5,643.5,742.5z M247.5,222.75
				c0-43.387,0-173.25,0-173.25h297c0,0,0,133.427,0,173.25c0,68.335-58.188,123.75-129.938,123.75h-37.125
				C305.687,346.5,247.5,291.085,247.5,222.75z M544.5,742.5h-297c0,0,0-129.888,0-173.25c0-68.335,58.187-123.75,129.938-123.75
				h37.125c71.75,0,129.938,55.415,129.938,123.75C544.5,609.072,544.5,742.5,544.5,742.5z"/>
		</g>
	</g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

                <time class="article-time--reading">
                    阅读时长: 40 分钟
                </time>
            </div>
        

         
        <div>
            <?xml version="1.0" encoding="iso-8859-1"?>
<!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 width="79.536px" height="79.536px" viewBox="0 0 79.536 79.536" style="enable-background:new 0 0 79.536 79.536;"
	 xml:space="preserve">
<g>
	<path style="fill:#010002;" d="M40.162,17.906C37.415,15.275,21.614,6.141,0,15.451c0,0.138,0,2.722,0,6.654v44.418h32.747
		c1.126,0.968,3.798,1.651,6.926,1.651c3.119,0,5.802-0.684,6.931-1.651h32.933V22.105c0-3.933,0-6.517,0-6.654
		C58.813,6.314,42.257,15.982,40.162,17.906z M37.229,63.349c0-1.75-15.372-11.981-33.125-0.818V19.216
		c3.516-2.014,8.246-3.249,13.463-3.249c10.864,0,19.662,3.562,19.662,10.175V63.349z M75.684,62.53
		c-17.751-11.163-33.108-0.932-33.108,0.818V26.146c0-6.612,8.792-10.175,19.646-10.175c5.22,0,9.952,1.235,13.463,3.249V62.53z"/>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
<g>
</g>
</svg>

            <time class="article-words">
                文章字数：19752字
            </time>
        </div>
        <div class="article-lastmod">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time>
                    Nov 20, 2024 22:49 &#43;0800
                </time>
            </div></footer>
    

    




    
</div>

</header>

    <section class="article-content">
    
    
    <details>
    <summary>为什么要学习Verilog</summary>
    <blockquote>
<p>因为本人在学校的五个verilog的数逻实验都是借助了魔法海螺(ai)来完成的，临近考试，诚惶诚恐，故补此知识点。（并且之后的龙芯杯也需要使用）</p>
</blockquote>
</details>

<h2 id="verliog知识点">Verliog知识点
</h2><h3 id="verilog-数据类型">Verilog 数据类型
</h3><p><span class="red">基本数据类型</span></p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th></th>
          <th><code>wire</code></th>
          <th><code>reg</code></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>定义与用途</strong></td>
          <td><code>wire</code> 用于声明连接不同模块或逻辑单元的信号，代表物理电路中的导线。 适用于组合逻辑和连续赋值（<code>assign</code> 语句）。</td>
          <td><code>reg</code> 用于在<strong>过程块</strong>（<code>always</code> 或 <code>initial</code> 块）中存储和保持值，类似于变量。 常用于时序逻辑（如寄存器）和组合逻辑中的状态存储。</td>
      </tr>
      <tr>
          <td><strong>赋值方式</strong></td>
          <td>只能通过<strong>连续赋值</strong>（<code>assign</code>）或模块实例化中的端口连接来驱动。</td>
          <td>只能在<strong>过程块</strong>中通过阻塞赋值（<code>=</code>）或非阻塞赋值（<code>&lt;=</code>）来驱动。</td>
      </tr>
      <tr>
          <td><strong>特性</strong></td>
          <td>不存储值，每当驱动信号发生变化时，<code>wire</code> 的值会立即更新。 可以被多个驱动源同时驱动（需要小心处理以避免竞争）。</td>
          <td>能够存储值，保持其状态直到被新赋值。 在时序逻辑中用于描述寄存器和状态。</td>
      </tr>
  </tbody>
</table></div>

<div class="notice notice-warning" >
    <div class="notice-title"><svg xmlns="http://www.w3.org/2000/svg" class="icon notice-icon" viewBox="0 0 576 512" fill="#704343"><path d="M570 440c18 32-5 72-42 72H48c-37 0-60-40-42-72L246 24c19-32 65-32 84 0l240 416zm-282-86a46 46 0 100 92 46 46 0 000-92zm-44-165l8 136c0 6 5 11 12 11h48c7 0 12-5 12-11l8-136c0-7-5-13-12-13h-64c-7 0-12 6-12 13z"/></svg></div><p><strong>常见易错点</strong></p>
<p>错误使用赋值方式</p>
<p><strong>错误</strong>：在过程块外对 <code>reg</code> 进行赋值，或在连续赋值中对 <code>reg</code> 进行驱动。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 错误：不能使用 assign 语句驱动 reg 类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//正确做法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 使用过程块内的赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>错误</strong>：在过程块内对 <code>wire</code> 进行赋值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 错误：不能在过程块内赋值 wire 类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//正确做法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 使用 assign 语句
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>混淆 <code>wire</code> 和 <code>reg</code> 的用途</p>
<p><strong>错误</strong>：将 <code>reg</code> 用于需要被多个模块驱动的信号，或者将 <code>wire</code> 用于需要存储状态的信号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// 错误示例：将需要存储状态的信号声明为 wire
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span> <span class="c1">// 错误：wire 类型不能在过程块中赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 正确做法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span> <span class="c1">// 使用 reg 类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>多重驱动信号</p>
<p><strong>错误</strong>：多个驱动源同时驱动同一个 <code>wire</code> 信号，可能导致竞态条件（race condition）或短路。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">a</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 错误：多个驱动源
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>解决方法</strong>：确保每个 <code>wire</code> 信号只有一个驱动源，或使用三态缓冲区控制信号驱动。</p>
<p>忘记初始化 <code>reg</code></p>
<p><strong>错误</strong>：在仿真中忘记初始化 <code>reg</code>，可能导致不确定的初始值。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span> <span class="c1">// count 未初始化，仿真时可能为 x
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>解决方法</strong>：</p>
<ul>
<li>使用复位信号初始化 <code>reg</code>。</li>
<li>在仿真中使用 <code>initial</code> 块赋初值。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="mb">&#39;b0000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>误解 <code>reg</code> 的硬件含义</p>
<p><strong>误区</strong>：<code>reg</code> 不一定对应硬件中的寄存器，取决于代码的具体描述。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">&amp;</span> <span class="n">c</span><span class="p">;</span> <span class="c1">// 组合逻辑中的 reg，实际硬件中不生成寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>解释</strong>：在组合逻辑中使用 <code>reg</code> 只是因为需要在过程块内赋值，并不意味着硬件中会有实际的寄存器。</p></div>

<p><span class="red">向量</span></p>
<p>在Verilog中，向量类型用于表示多位信号或数据。与单比特（单一的0或1）信号不同，向量可以表示多个比特的组合，如字节（8位）、字（16位或32位）等。向量使得处理和传输多位数据更加便捷和高效。在Verilog中，向量通过指定范围来声明。范围由高位和低位索引组成，格式如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="err">高位</span><span class="o">:</span><span class="err">低位</span><span class="p">]</span> <span class="err">信号名</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span>  <span class="p">[</span><span class="err">高位</span><span class="o">:</span><span class="err">低位</span><span class="p">]</span> <span class="err">信号名</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//具体来说
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_bus</span><span class="p">;</span>    <span class="c1">// 8位数据总线，位7到位0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">nibble</span><span class="p">;</span>      <span class="c1">// 4位半字节，位3到位0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">address</span><span class="p">;</span>     <span class="c1">// 32位地址信号，位31到位0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//Verilog允许指定向量的高位到低位，也可以反向指定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_bus</span><span class="p">;</span>    <span class="c1">// 位7是最高位，位0是最低位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">7</span><span class="p">]</span> <span class="n">data_bus_rev</span><span class="p">;</span> <span class="c1">// 位0是最高位，位7是最低位
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>在verilog中，还允许对向量进行诸多操作，如连接与拼接、位选取与范围选择、位切片、赋值等，详细见下。</p>
<ol>
<li>
<p>连接与拼接</p>
<p>Verilog允许通过连接运算符（<code>{}</code>）将多个信号拼接成一个向量，或将一个向量拆分成多个信号。</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">nibble1</span><span class="p">,</span> <span class="n">nibble2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="kt">byte</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 拼接
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">assign</span> <span class="kt">byte</span> <span class="o">=</span> <span class="p">{</span><span class="n">nibble1</span><span class="p">,</span> <span class="n">nibble2</span><span class="p">};</span> <span class="c1">// 将nibble1作为高位，nibble2作为低位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 拆分
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">assign</span> <span class="p">{</span><span class="n">nibble1</span><span class="p">,</span> <span class="n">nibble2</span><span class="p">}</span> <span class="o">=</span> <span class="kt">byte</span><span class="p">;</span> <span class="c1">// 从byte中提取高4位到nibble1，低4位到nibble2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//甚至还可以↓
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span><span class="mh">4</span><span class="p">{</span><span class="n">w</span><span class="p">}}</span>       <span class="c1">//这等同于{w,w,w,w}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span><span class="n">b</span><span class="p">,{</span><span class="mh">3</span><span class="p">{</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">}}}</span> <span class="c1">//这等同于{b,a,b,a,b,a,b}
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>
<p>位选取与范围选择</p>
<p>Verilog允许访问向量中的单个比特或一段范围。</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//单比特选取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_bus</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">bit7</span> <span class="o">=</span> <span class="n">data_bus</span><span class="p">[</span><span class="mh">7</span><span class="p">];</span> <span class="c1">// 访问第7位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="n">bit0</span> <span class="o">=</span> <span class="n">data_bus</span><span class="p">[</span><span class="mh">0</span><span class="p">];</span> <span class="c1">// 访问第0位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//范围选取
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">word</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">lower_byte</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>    <span class="c1">// 访问低8位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">upper_byte</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">];</span>   <span class="c1">// 访问高8位
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="3">
<li>
<p>位切片（Bit Slicing）</p>
<p>可以通过动态计算的索引来访问向量的一部分，但需要使用生成语句或任务/函数。</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">byte0</span><span class="p">,</span> <span class="n">byte1</span><span class="p">,</span> <span class="n">byte2</span><span class="p">,</span> <span class="n">byte3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">byte0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">byte1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mh">15</span><span class="o">:</span><span class="mh">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">byte2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mh">23</span><span class="o">:</span><span class="mh">16</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">byte3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">24</span><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="4">
<li>
<p>向量的赋值</p>
<p>向量可以通过连续赋值（<code>assign</code>）或过程赋值（<code>always</code>块内）进行赋值。</p>
</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//连续赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">c</span> <span class="o">=</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">;</span> <span class="c1">// 位与操作
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//过程赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">counter</span> <span class="o">&lt;=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="5">
<li>缩减运算符</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">C</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">C</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">B</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//相当于C =( (B[0]&amp;B[1]) &amp; B[2] ) &amp; B[3];
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><span class="red">整数，实数，时间寄存器变量</span></p>
<p><strong>整数（integer）</strong></p>
<p>整数类型用关键字 integer 来声明。声明时不用指明位宽，位宽和编译器有关，一般为32 bit。reg 型变量为无符号数，而 integer 型变量为有符号数。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data1</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>  <span class="n">byte1</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">];</span> <span class="c1">//数组变量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">integer</span>    <span class="n">j</span><span class="p">;</span>           <span class="c1">//整型变量，用来辅助生成数字电路
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">always</span><span class="p">@</span><span class="o">*</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mh">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;=</span><span class="mh">3</span><span class="p">;</span><span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="o">+</span><span class="mh">1</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">byte1</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[(</span><span class="n">j</span><span class="o">+</span><span class="mh">1</span><span class="p">)</span><span class="o">*</span><span class="mh">8</span><span class="o">-</span><span class="mh">1</span> <span class="o">:</span> <span class="n">j</span><span class="o">*</span><span class="mh">8</span><span class="p">];</span>  
</span></span><span class="line"><span class="cl">        	<span class="c1">//把data1[7:0]…data1[31:24] 依次赋值给 byte1[0][7:0]…byte[3][7:0]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>integer 信号 j 作为辅助信号，将 data1 的数据依次赋值给数组 byte1。综合后实际电路里并没有 j 这个信号，j 只是辅助生成相应的硬件电路。</p>
<p><strong>实数（real）</strong></p>
<p>实数用关键字 real 来声明，可用十进制或科学计数法来表示。实数声明不能带有范围，默认值为 0。如果将一个实数赋值给一个整数，则只有实数的整数部分会赋值给整数。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">real</span>        <span class="n">data1</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">integer</span>     <span class="n">temp</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">data1</span> <span class="o">=</span> <span class="mf">2e3</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">data1</span> <span class="o">=</span> <span class="mf">3.75</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">temp</span> <span class="o">=</span> <span class="n">data1</span> <span class="p">;</span> <span class="c1">//temp 值的大小为3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>时间（time）</strong></p>
<p>Verilog 使用特殊的时间寄存器 time 型变量，对仿真时间进行保存。其宽度一般为 64 bit，通过调用系统函数 $time 获取当前仿真时间。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">time</span>       <span class="n">current_time</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">       <span class="p">#</span><span class="mh">100</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">       <span class="n">current_time</span> <span class="o">=</span> <span class="nb">$time</span> <span class="p">;</span> <span class="c1">//current_time 的大小为 100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>数组</strong></p>
<p>在 Verilog 中允许声明 reg, wire, integer, time, real 及其向量类型的数组。数组维数没有限制。线网数组也可以用于连接实例模块的端口。数组中的每个元素都可以作为一个标量或者向量，以同样的方式来使用，形如：<strong>&lt;数组名&gt;[&lt;下标&gt;]</strong>。对于多维数组来讲，用户需要说明其每一维的索引。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">integer</span>          <span class="n">flag</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">;</span>     <span class="c1">//8个整数组成的数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span>  <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>       <span class="n">counter</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">;</span>  <span class="c1">//由4个4bit计数器组成的数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>       <span class="n">addr_bus</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">;</span> <span class="c1">//由4个8bit wire型变量组成的数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span>             <span class="n">data_bit</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">5</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">;</span>             <span class="c1">//声明1bit wire型变量的二维数组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="p">[</span><span class="mh">31</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>       <span class="n">data_4d</span><span class="p">[</span><span class="mh">11</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">][</span><span class="mh">255</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="p">;</span> <span class="c1">//声明4维的32bit数据变量数组
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>虽然数组与向量的访问方式在一定程度上类似，但不要将向量和数组混淆。向量是一个单独的元件，位宽为 n；数组由多个元件组成，其中每个元件的位宽为 n 或 1。它们在结构的定义上就有所区别。</p>
<p><strong>存储器</strong></p>
<p>存储器变量就是一种寄存器数组，可用来描述 RAM 或 ROM 的行为。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span>               <span class="n">membit</span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">255</span><span class="p">]</span> <span class="p">;</span>  <span class="c1">//256bit的1bit存储器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span>  <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>        <span class="n">mem</span><span class="p">[</span><span class="mh">0</span><span class="o">:</span><span class="mh">1023</span><span class="p">]</span> <span class="p">;</span>    <span class="c1">//1Kbyte存储器，位宽8bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">mem</span><span class="p">[</span><span class="mh">511</span><span class="p">]</span> <span class="o">=</span> <span class="mh">8</span><span class="mb">&#39;b0</span> <span class="p">;</span>                  <span class="c1">//令第512个8bit的存储单元值为0
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>参数</strong></p>
<p>参数用来表示常量，用关键字 parameter 声明，只能赋值一次。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">parameter</span>      <span class="n">data_width</span> <span class="o">=</span> <span class="mh">10</span><span class="mi">&#39;d32</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">parameter</span>      <span class="n">i</span><span class="o">=</span><span class="mh">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="mh">2</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mh">3</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">parameter</span>      <span class="n">mem_size</span> <span class="o">=</span> <span class="n">data_width</span> <span class="o">*</span> <span class="mh">10</span> <span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>字符串</strong></p>
<p>字符串保存在 reg 类型的变量中，每个字符占用一个字节（8bit）。因此寄存器变量的宽度应该足够大，以保证不会溢出。字符串不能多行书写，即字符串中不能包含回车符。如果寄存器变量的宽度大于字符串的大小，则使用 0 来填充左边的空余位；如果寄存器变量的宽度小于字符串大小，则会截去字符串左边多余的数据。例如，为存储字符串 &ldquo;hello-verilog&rdquo;, 需要 13*8bit 的存储单元：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">0</span><span class="o">:</span> <span class="mh">13</span><span class="o">*</span><span class="mh">8</span><span class="o">-</span><span class="mh">1</span><span class="p">]</span>       <span class="n">str</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;hello-verilog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="verilog-操作符分类表">Verilog 操作符分类表
</h3><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th><strong>操作符类别</strong></th>
          <th><strong>操作符</strong></th>
          <th><strong>描述</strong></th>
          <th><strong>示例</strong></th>
          <th><strong>优先级</strong></th>
          <th><strong>结合性</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>算术操作符</strong></td>
          <td><code>+</code></td>
          <td>加法</td>
          <td><code>a + b</code></td>
          <td>14</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>-</code></td>
          <td>减法</td>
          <td><code>a - b</code></td>
          <td>14</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>*</code></td>
          <td>乘法</td>
          <td><code>a * b</code></td>
          <td>13</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>/</code></td>
          <td>除法</td>
          <td><code>a / b</code></td>
          <td>13</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>%</code></td>
          <td>取模（取余）</td>
          <td><code>a % b</code></td>
          <td>13</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>**</code></td>
          <td>指数（幂运算）</td>
          <td><code>a ** b</code></td>
          <td>12</td>
          <td>右结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>-</code> (一元)</td>
          <td>取负（改变符号）</td>
          <td><code>-a</code></td>
          <td>15</td>
          <td>右结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>+</code> (一元)</td>
          <td>正号（通常不改变值）</td>
          <td><code>+a</code></td>
          <td>15</td>
          <td>右结合</td>
      </tr>
      <tr>
          <td><strong>关系操作符</strong></td>
          <td><code>&lt;</code></td>
          <td>小于</td>
          <td><code>a &lt; b</code></td>
          <td>10</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&lt;=</code></td>
          <td>小于或等于</td>
          <td><code>a &lt;= b</code></td>
          <td>10</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&gt;</code></td>
          <td>大于</td>
          <td><code>a &gt; b</code></td>
          <td>10</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&gt;=</code></td>
          <td>大于或等于</td>
          <td><code>a &gt;= b</code></td>
          <td>10</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td><strong>等价操作符</strong></td>
          <td><code>==</code></td>
          <td>相等</td>
          <td><code>a == b</code></td>
          <td>9</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>!=</code></td>
          <td>不相等</td>
          <td><code>a != b</code></td>
          <td>9</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>===</code></td>
          <td>严格相等（包括X和Z）</td>
          <td><code>a === b</code></td>
          <td>9</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>!==</code></td>
          <td>严格不相等（包括X和Z）</td>
          <td><code>a !== b</code></td>
          <td>9</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td><strong>逻辑操作符</strong></td>
          <td><code>&amp;&amp;</code></td>
          <td>逻辑与</td>
          <td><code>a &amp;&amp; b</code></td>
          <td>5</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>||</code></td>
          <td>逻辑或</td>
          <td><code>a || b</code></td>
          <td>5</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>!</code></td>
          <td>逻辑非</td>
          <td><code>!a</code></td>
          <td>15</td>
          <td>右结合</td>
      </tr>
      <tr>
          <td><strong>按位操作符</strong></td>
          <td><code>&amp;</code></td>
          <td>按位与</td>
          <td><code>a &amp; b</code></td>
          <td>8</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>|</code></td>
          <td>按位或</td>
          <td><code>a | b</code></td>
          <td>8</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>^</code></td>
          <td>按位异或</td>
          <td><code>a ^ b</code></td>
          <td>6</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~</code></td>
          <td>按位非</td>
          <td><code>~a</code></td>
          <td>15</td>
          <td>右结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~&amp;</code></td>
          <td>按位与非（NAND）</td>
          <td><code>~&amp;a</code></td>
          <td>8</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~</code></td>
          <td>按位或非（NOR）</td>
          <td><code>~a</code></td>
          <td>8</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~^</code> 或 <code>^~</code></td>
          <td>按位异或非（XNOR）</td>
          <td><code>~^a</code> 或 <code>^~a</code></td>
          <td>6</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td><strong>归约操作符</strong></td>
          <td><code>&amp;</code></td>
          <td>归约与（所有位进行逻辑与）</td>
          <td><code>&amp;a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td></td>
          <td><code>|</code></td>
          <td>归约或（所有位进行逻辑或）</td>
          <td><code>|a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td></td>
          <td><code>^</code></td>
          <td>归约异或（所有位进行逻辑异或）</td>
          <td><code>^a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~&amp;</code></td>
          <td>归约与非（所有位进行逻辑与后取反）</td>
          <td><code>~&amp;a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~</code></td>
          <td>归约或非（所有位进行逻辑或后取反）</td>
          <td><code>~a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td></td>
          <td><code>~^</code> 或 <code>^~</code></td>
          <td>归约异或非（所有位进行逻辑异或后取反）</td>
          <td><code>~^a</code> 或 <code>^~a</code></td>
          <td>-</td>
          <td>-</td>
      </tr>
      <tr>
          <td><strong>移位操作符</strong></td>
          <td><code>&lt;&lt;</code></td>
          <td>逻辑左移</td>
          <td><code>a &lt;&lt; 1</code></td>
          <td>11</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&gt;&gt;</code></td>
          <td>逻辑右移</td>
          <td><code>a &gt;&gt; 1</code></td>
          <td>11</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&lt;&lt;&lt;</code></td>
          <td>算术左移（通常与逻辑左移相同）</td>
          <td><code>a &lt;&lt;&lt; 1</code></td>
          <td>11</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>&gt;&gt;&gt;</code></td>
          <td>算术右移（保持符号位）</td>
          <td><code>a &gt;&gt;&gt; 1</code></td>
          <td>11</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td><strong>拼接操作符</strong></td>
          <td><code>{}</code></td>
          <td>拼接多个信号或值为一个向量</td>
          <td><code>{a, b}</code></td>
          <td>3</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td></td>
          <td><code>{{}}</code></td>
          <td>重复拼接（如 <code>{3{a}}</code> 表示 <code>a</code> 重复3次拼接）</td>
          <td><code>{{3{a}}}</code></td>
          <td>3</td>
          <td>左结合</td>
      </tr>
      <tr>
          <td><strong>条件操作符</strong></td>
          <td><code>?:</code></td>
          <td>条件（三元）操作符，例如 <code>condition ? expr1 : expr2</code></td>
          <td><code>sel ? a : b</code></td>
          <td>2</td>
          <td>右结合</td>
      </tr>
  </tbody>
</table></div>
<h3 id="verilog-数值表示">Verilog 数值表示
</h3><p>Verilog HDL 有下列四种基本的值来表示硬件电路中的电平逻辑：</p>
<ul>
<li>0：逻辑 0 或 &ldquo;假&rdquo;</li>
<li>1：逻辑 1 或 &ldquo;真&rdquo;</li>
<li>x 或 X：未知</li>
<li>z 或 Z：高阻</li>
</ul>
<p><strong>x</strong> 意味着信号数值的不确定，即在实际电路里，信号可能为 1，也可能为 0。</p>
<p><strong>z</strong> 意味着信号处于高阻状态，常见于信号（input, reg）没有驱动时的逻辑结果。例如一个 pad 的 input 呈现高阻状态时，其逻辑值和上下拉的状态有关系。上拉则逻辑值为 1，下拉则为 0 。</p>
<p><span class="red">整数数值表示方法</span></p>
<p>数字声明时，合法的基数格式有 4 中，包括：十进制(&rsquo;d 或 &lsquo;D)，十六进制(&lsquo;h 或 &lsquo;H)，二进制（&lsquo;b 或 &lsquo;B），八进制（&lsquo;o 或 &lsquo;O）。数值可指明位宽，也可不指明位宽。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="mh">4</span><span class="mb">&#39;b1011</span>         <span class="c1">// 4bit 数值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mh">32&#39;h3022</span><span class="n">_c0de</span>   <span class="c1">// 32bit 的数值
</span></span></span><span class="line"><span class="cl"><span class="c1">//下划线 _ 是为了增强代码的可读性
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>不指明位宽时，一般直接写数字，默认为十进制表示，例如下面的 3 种写法是等效的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="n">counter</span> <span class="o">=</span> <span class="mi">&#39;d100</span> <span class="p">;</span>  <span class="c1">//一般会根据编译器自动分频位宽，常见的为32bit*
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">counter</span> <span class="o">=</span> <span class="mh">100</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">counter</span> <span class="o">=</span> <span class="mh">32&#39;h64</span> <span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>负数表示，通常在表示位宽的数字前面加一个减号来表示负数。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="o">-</span><span class="mh">6</span><span class="mi">&#39;d15</span>  
</span></span><span class="line"><span class="cl"><span class="o">-</span><span class="mh">15</span>
</span></span><span class="line"><span class="cl"><span class="c1">//-15 在 5 位二进制中的形式为 5&#39;b10001, 在 6 位二进制中的形式为 6&#39;b11_0001
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//需要注意的是，减号放在基数和数字之间是非法的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mh">4</span><span class="p">&#39;</span><span class="n">d</span><span class="o">-</span><span class="mh">2</span> <span class="c1">//非法说明
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><span class="red">实数表示方法</span></p>
<p>实数表示方法主要有两种方式</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//十进制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">30.123</span>
</span></span><span class="line"><span class="cl"><span class="mf">6.0</span>
</span></span><span class="line"><span class="cl"><span class="mf">3.0</span>
</span></span><span class="line"><span class="cl"><span class="mf">0.001</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//科学计数法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">1.2e4</span>         <span class="c1">//大小为12000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mh">1</span><span class="n">_0001e4</span>      <span class="c1">//大小为100010000
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="mf">1E-3</span>          <span class="c1">//大小为0.001
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><span class="red">字符串表示方法</span></p>
<p>字符串是由双引号包起来的字符队列。字符串不能多行书写，即字符串中不能包含回车符。Verilog 将字符串当做一系列的单字节 ASCII 字符队列。例如，为存储字符串 &ldquo;hello-verilog&rdquo;, 需要 13*8bit 的存储单元。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">0</span><span class="o">:</span> <span class="mh">13</span><span class="o">*</span><span class="mh">8</span><span class="o">-</span><span class="mh">1</span><span class="p">]</span>    <span class="n">str</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">  <span class="n">str</span> <span class="o">=</span> <span class="s">&#34;hello-verilog&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span> 
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="verilog-状态机">Verilog 状态机
</h3><p>有限状态机（Finite-State Machine，FSM），简称状态机，是表示有限个状态以及在这些状态之间的转移和动作等行为的数学模型。状态机不仅是一种电路的描述工具，而且也是一种思想方法，在电路设计的系统级和 RTL 级有着广泛的应用。</p>
<p><span class="red">状态机类型</span></p>
<p>Verilog 中状态机主要用于同步时序逻辑的设计，能够在有限个状态之间按一定要求和规律切换时序电路的状态。状态的切换方向不但取决于各个输入值，还取决于当前所在状态。 状态机可分为 2 类：Moore 状态机和 Mealy 状态机。</p>
<p><strong>Moore 型状态机</strong></p>
<p>Moore 型状态机的输出只与当前状态有关，与当前输入无关。输出会在一个完整的时钟周期内保持稳定，即使此时输入信号有变化，输出也不会变化。输入对输出的影响要到下一个时钟周期才能反映出来。这也是 Moore 型状态机的一个重要特点：输入与输出是隔离开来的。</p>
<p><strong>Mealy 型状态机</strong></p>
<p>Mealy 型状态机的输出，不仅与当前状态有关，还取决于当前的输入信号。Mealy 型状态机的输出是在输入信号变化以后立刻发生变化，且输入变化可能出现在任何状态的时钟周期内。因此，同种逻辑下，Mealy 型状态机输出对输入的响应会比 Moore 型状态机早一个时钟周期。</p>
<p><span class="red">状态机设计：3 段式</span></p>
<p>众所周知，许多设计规范和最佳实践都推荐使用三段式状态机。这有助于确保设计的一致性和可靠性，尤其在团队合作和大规模项目中尤为重要。将状态机分为三个独立的部分（状态寄存器、下一个状态逻辑、输出逻辑）使得设计更加模块化。每个部分有明确的职责，便于理解和管理。由于各部分职责分明，修改或扩展某一部分（如添加新的状态或修改输出逻辑）不会影响其他部分。这大大提高了设计的可维护性和可扩展性。并且，通过将状态寄存器与状态转移逻辑分离，避免了时序逻辑和组合逻辑的混杂。这有助于减少时序相关的问题，如竞态条件和冒险（hazards）。</p>
<p><strong>状态机设计如下：</strong></p>
<ul>
<li>(0) 首先，根据状态机的个数确定状态机编码。利用编码给状态寄存器赋值，代码可读性更好。</li>
<li>(1) 状态机第一段，时序逻辑，非阻塞赋值，传递寄存器的状态。</li>
<li>(2) 状态机第二段，组合逻辑，阻塞赋值，根据当前状态和当前输入，确定下一个状态机的状态。</li>
<li>(3) 状态机第三代，时序逻辑，非阻塞赋值，因为是 Mealy 型状态机，根据当前状态和当前输入，确定输出信号。</li>
</ul>
<p>下面给出一个简单的状态机代码。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">fsm_example</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">clk</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">rst_n</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">input_signal</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="kt">reg</span> <span class="n">output_signal</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 状态编码 using localparam
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">localparam</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">        <span class="n">STATE_IDLE</span>    <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">STATE_ACTIVE</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">STATE_DONE</span>    <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 状态寄存器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 状态机第一段，时序逻辑，非阻塞赋值，传递寄存器的状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">negedge</span> <span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">STATE_IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 状态机第二段，组合逻辑，阻塞赋值，根据当前状态和当前输入，确定下一个状态机的状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">input_signal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STATE_ACTIVE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STATE_IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_ACTIVE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STATE_DONE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_DONE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STATE_IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STATE_IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 状态机第三代，时序逻辑，非阻塞赋值，因为是 Mealy 型状态机，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// 根据当前状态和当前输入，确定输出信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">output_signal</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_ACTIVE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">output_signal</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STATE_DONE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">output_signal</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="n">output_signal</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="verilog-竞争与冒险">Verilog 竞争与冒险
</h3><p><span class="red">产生原因</span></p>
<p>数字电路中，信号传输与状态变换时都会有一定的延时。</p>
<ul>
<li>在组合逻辑电路中，不同路径的输入信号变化传输到同一点门级电路时，在时间上有先有后，这种先后所形成的时间差称为竞争（Competition）。</li>
<li>由于竞争的存在，输出信号需要经过一段时间才能达到期望状态，过渡时间内可能产生瞬间的错误输出，例如尖峰脉冲。这种现象被称为冒险（Hazard）。</li>
<li>竞争不一定有冒险，但冒险一定会有竞争。</li>
</ul>
<p><span class="red">避免方法</span></p>
<p>在编程时多注意以下几点，也可以避免大多数的竞争与冒险问题。</p>
<ul>
<li>1）时序电路建模时，用非阻塞赋值。</li>
<li>2）组合逻辑建模时，用阻塞赋值。</li>
<li>3）在同一个 always 块中建立时序和组合逻辑模型时，用非阻塞赋值。</li>
<li>4）在同一个 always 块中不要既使用阻塞赋值又使用非阻塞赋值。</li>
<li>5）不要在多个 always 块中为同一个变量赋值。</li>
<li>6）避免 latch 产生。</li>
</ul>
<p>时序电路中非阻塞赋值可以消除竞争冒险。由于无法确定 a 与 b 阻塞赋值的操作顺序，就有可能带来竞争冒险。使用非阻塞赋值时，赋值操作是同时进行的，所以就不会带来竞争冒险。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//不会带来竞争冒险
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">a</span> <span class="o">&lt;=</span> <span class="n">b</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">b</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>我们想实现 C = A&amp;B, F=C&amp;D 的组合逻辑功能，用非阻塞赋值语句如下。两条赋值语句同时赋值，F &lt;= C &amp; D 中使用的是信号 C 的旧值，所以导致此时的逻辑是错误的，F 的逻辑值不等于 A&amp;B&amp;D。而且，此时要求信号 C 具有存储功能，但不是时钟驱动，所以 C 可能会被综合成锁存器（latch），导致竞争冒险。对代码修改后，F = C &amp; D 的操作一定是在 C = A &amp; B 之后，此时 F 的逻辑值等于 A&amp;B&amp;D，符合设计。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">C</span> <span class="o">&lt;=</span> <span class="n">A</span> <span class="o">&amp;</span> <span class="n">B</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span> <span class="o">&lt;=</span> <span class="n">C</span> <span class="o">&amp;</span> <span class="n">D</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="c1">//fix ↓
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">&amp;</span> <span class="n">B</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span> <span class="o">=</span> <span class="n">C</span> <span class="o">&amp;</span> <span class="n">D</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>同一个 always 块中建立时序和组合逻辑模型时，用非阻塞赋值。虽然时序电路中可能涉及组合逻辑，但是如果赋值操作使用非阻塞赋值，仍然会导致如规范 1 中所涉及的类似问题。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">negedge</span> <span class="n">rst_n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">rst_n</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">q</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">q</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">&amp;</span> <span class="n">b</span><span class="p">;</span>  <span class="c1">//即便有组合逻辑，也不要写成：q = a &amp; b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>同一个 always 块中不要既使用阻塞赋值又使用非阻塞赋值。always 涉及的组合逻辑中，既有阻塞赋值又有非阻塞赋值时，会导致意外的结果，例如下面代码描述。此时信号 C 阻塞赋值完毕以后，信号 F 才会被非阻塞赋值，仿真结果可能正确。但如果 F 信号有其他的负载，F 的最新值并不能马上传递出去，数据有效时间还是在下一个触发时刻。此时要求 F 具有存储功能，可能会被综合成 latch，导致竞争冒险。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">&amp;</span> <span class="n">B</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">F</span> <span class="o">&lt;=</span> <span class="n">C</span> <span class="o">&amp;</span> <span class="n">D</span> <span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>不要在多个 always 块中为同一个变量赋值。此时信号拥有多驱动端（Multiple Driver），是禁止的。当然，也不允许 assign 语句为同一个变量进行多次连线赋值。</p>
<h3 id="testbench-概述">Testbench 概述
</h3><p><strong>定义与目的</strong></p>
<ul>
<li><strong>定义</strong>：Testbench 是一个独立的Verilog模块，用于仿真和验证被测模块（Module Under Test，MUT）的功能。</li>
<li><strong>目的</strong>：提供输入信号、监控输出信号、验证设计的正确性。</li>
</ul>
<p><strong>基本特点</strong></p>
<ul>
<li>不包含端口（port）。</li>
<li>包含信号声明、被测模块实例化、刺激生成和输出监控等部分。</li>
</ul>
<p><span class="red">Testbench 的基本组成部分</span></p>
<ol>
<li>
<p><strong>timescale 指令</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="no">`timescale</span> <span class="o">&lt;</span><span class="err">时间单位</span><span class="o">&gt;</span> <span class="o">/</span> <span class="o">&lt;</span><span class="err">时间精度</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//&lt;时间单位&gt;：定义延迟和仿真时间的基本单位。
</span></span></span><span class="line"><span class="cl"><span class="c1">//&lt;时间精度&gt;：定义仿真内部时间的最小步长。
</span></span></span><span class="line"><span class="cl"><span class="c1">// 对于大多数数字电路设计，1ns / 1ps 或 10ns / 1ps 是常见且高效的选择。
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>时间单位（Time Unit）</strong></p>
<ul>
<li><strong>定义</strong>：时间单位指定了Verilog中时间延迟和仿真时间的基本单位。例如，<code>1ns</code> 表示1纳秒。</li>
<li><strong>用途</strong>：用于定义延迟（如 <code>#5</code>）、仿真时间的显示格式等。</li>
</ul>
<p><strong>时间精度（Time Precision）</strong></p>
<ul>
<li><strong>定义</strong>：时间精度指定了时间单位中最小的时间步长。例如，<code>1ps</code> 表示时间步长为1皮秒。</li>
<li><strong>用途</strong>：影响仿真中时间的分辨率和计算精度。</li>
</ul>
</li>
<li>
<p><strong>模块声明</strong></p>
<ul>
<li>使用 <code>module</code> 关键字声明Testbench模块。</li>
<li>不需要端口列表。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">module</span> <span class="n">testbench_name</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>信号声明</strong></p>
<ul>
<li><strong>输入信号</strong>：通常声明为 <code>reg</code> 类型，因为它们将在过程块中被驱动。</li>
<li><strong>输出信号</strong>：声明为 <code>wire</code> 类型，因为它们由被测模块驱动。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">clk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">rst_n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">en</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>被测模块实例化</strong></p>
<ul>
<li>使用被测模块的名称和实例名（如 <code>uut</code>，代表 Unit Under Test）。</li>
<li>通过端口映射（<code>.port_name(signal_name)</code>）连接Testbench中的信号与被测模块的端口。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="n">module_name</span> <span class="n">uut</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">clk</span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">rst_n</span><span class="p">(</span><span class="n">rst_n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">en</span><span class="p">(</span><span class="n">en</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>生成输入信号</strong></p>
<ul>
<li><strong>时钟信号生成</strong>：通常使用 <code>initial</code> 块与 <code>forever</code> 循环结合 <code>#</code> 延迟来实现时钟信号。</li>
<li><strong>复位信号生成</strong>：在 <code>initial</code> 块中设置复位信号的初始状态和变化。</li>
<li><strong>其他输入信号生成</strong>：使用 <code>initial</code> 或 <code>always</code> 块控制其他输入信号的变化。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">clk</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">forever</span> <span class="p">#</span><span class="mh">5</span> <span class="n">clk</span> <span class="o">=</span> <span class="o">~</span><span class="n">clk</span><span class="p">;</span> <span class="c1">// 生成时钟，周期10个时间单位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">10</span> <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span> <span class="c1">// 释放复位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>监控输出信号</strong></p>
<ul>
<li>使用系统任务如 <code>$monitor</code>、<code>$display</code> 来观察和记录被测模块的输出信号变化。</li>
<li><strong><code>$monitor</code></strong>：实时监控指定信号的变化。</li>
<li><strong><code>$display</code></strong>：在特定时刻输出信号信息。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="nb">$monitor</span><span class="p">(</span><span class="s">&#34;Time=%0t | rst_n=%b | en=%b | count=%d&#34;</span><span class="p">,</span> <span class="nb">$time</span><span class="p">,</span> <span class="n">rst_n</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>结束仿真</strong></p>
<ul>
<li>使用 <code>$finish</code> 任务在特定条件下结束仿真。</li>
<li>可以在 <code>initial</code> 块中通过延迟控制仿真结束的时机。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="p">#</span><span class="mh">100</span><span class="p">;</span> <span class="c1">// 仿真时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nb">$finish</span><span class="p">;</span> <span class="c1">// 结束仿真
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><span class="red">Testbench 的高级功能</span></p>
<ol>
<li>
<p><strong>任务（Tasks）和函数（Functions）</strong></p>
<ul>
<li><strong>任务</strong>：封装重复使用的操作，如复位信号生成。</li>
<li><strong>函数</strong>：封装返回值的操作，适用于计算和逻辑判断。</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">task</span> <span class="n">reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">#</span><span class="mh">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">endtask</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>生成波形文件</strong></p>
<p>使用 <code>$dumpfile</code> 和 <code>$dumpvars</code> 生成波形文件（如 <code>.vcd</code> 文件），用于后续波形查看和分析。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">$dumpfile</span><span class="p">(</span><span class="s">&#34;testbench.vcd&#34;</span><span class="p">);</span> <span class="c1">// 指定波形文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">$dumpvars</span><span class="p">(</span><span class="mh">0</span><span class="p">,</span> <span class="n">testbench_name</span><span class="p">);</span> <span class="c1">// 记录所有信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>断言（Assertions）</strong></p>
<p>使用 SystemVerilog 的断言功能自动检查设计的正确性，提高测试效率。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">assert</span> <span class="p">(</span><span class="n">count</span> <span class="o">&lt;=</span> <span class="mh">4</span><span class="mi">&#39;d15</span><span class="p">)</span> <span class="k">else</span> <span class="n">$fatal</span><span class="p">(</span><span class="s">&#34;Count overflowed!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><span class="red">Testbench 编写步骤总结</span></p>
<ol>
<li><strong>模块声明</strong>：不包含端口，使用 <code>module</code> 和 <code>endmodule</code> 包围整个Testbench。</li>
<li><strong>信号声明</strong>
<ul>
<li>使用 <code>reg</code> 类型声明将被驱动的输入信号。</li>
<li>使用 <code>wire</code> 类型声明被测模块的输出信号。</li>
</ul>
</li>
<li><strong>被测模块实例化</strong>：使用模块名称和实例名，连接Testbench中的信号与被测模块的端口。</li>
<li><strong>生成输入信号</strong>：使用 <code>initial</code> 块和 <code>always</code> 块生成时钟、复位及其他输入信号。</li>
<li><strong>监控输出信号</strong>：使用 <code>$monitor</code>、<code>$display</code> 等任务实时观察被测模块的输出。</li>
<li><strong>结束仿真</strong>：使用 <code>$finish</code> 任务在合适的时机结束仿真。</li>
</ol>
<p><span class="red">常用的系统任务和函数</span></p>
<ol>
<li>
<p><strong><code>$monitor</code></strong></p>
<ul>
<li>持续监控并输出指定信号的变化。</li>
<li>语法：<code>$monitor(&quot;格式字符串&quot;, 参数列表);</code></li>
</ul>
</li>
<li>
<p><strong><code>$display</code></strong></p>
<ul>
<li>在特定时刻输出信号信息。</li>
<li>语法：<code>$display(&quot;格式字符串&quot;, 参数列表);</code></li>
</ul>
</li>
<li>
<p><strong><code>$finish</code></strong></p>
<ul>
<li>结束仿真。</li>
<li>语法：<code>$finish;</code></li>
</ul>
</li>
<li>
<p><strong><code>$dumpfile</code> 和 <code>$dumpvars</code></strong></p>
<ul>
<li>生成波形文件，用于后续的波形分析。</li>
<li>语法：
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="n">$dumpfile</span><span class="p">(</span><span class="s">&#34;filename.vcd&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">$dumpvars</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">module_name</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
<li>
<p><strong><code>$stop</code></strong></p>
<ul>
<li>暂停仿真，进入交互模式（部分仿真工具支持）。</li>
<li>语法：<code>$stop;</code></li>
</ul>
</li>
</ol>
<h3 id="语法补充">语法补充
</h3><p><span class="red">循环语句</span></p>
<p>在Verilog HDL中也存在循环语句。可以综合的循环语句为for语句，并且这个for语句和C语句中的for语句使用形式完全一样。for语句的形式为：for (表达式1；表达式2；表达式3）语句；</p>
<p>也即:for（循环变量赋初值；循环结束条件；循环变量增值）执行语句；上述的展开表达分别解释了表达形式中的表达式1，表达式2和表达式3的含义。可以看到，确实与C语言中的对应的for循环语句完全是一样的。</p>
<p>对于循环语句来说，不太容易想象得出综合之后的效果，因为这方面并不直观。这一点确实是这样，对于循环来说，综合器处理起来也并不容易，并且对于不同的综合器来说，不一定是可以综合的。相比于前面讨论的语句（赋值和判断语句），for循环语句描述的功能更加高层和抽象（也包括其它类型的循环语句）。虽然写程序容易，但是转化为硬件的难度会更大。即便转化完成，可能所需要的硬件资源也很多，效率不高。因此，除非是一些对语句进行重复设置的情况，尽量不要使用循环语句，以免对综合器造成困扰。</p>
<p>除了上述的for语句之外，在Verilog HDL中也有其它三个循环语句，分别为<code>forever</code>语句，<code>repeat</code>语句，<code>while</code>语句。其中<code>forever</code>语句会连续执行语句，主要在仿真中使用，用以生成周期性的波形，例如时钟信号。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// repeat语句的使用格式为：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">repeat</span><span class="p">(</span><span class="err">循环次数的表达式</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//语句或者语句块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span> 
</span></span><span class="line"><span class="cl"><span class="c1">//单个语句不需要begin和end
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// while语句的使用格式为：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">while</span><span class="p">(</span><span class="err">循环执行的条件表达式</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//语句或者语句块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span> 
</span></span><span class="line"><span class="cl"><span class="c1">//单个语句不需要begin和end
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>由于repeat语句和while语句的功能实际上都可以通过for语句表达出来，另外也由于for语句在大部分的EDA工具中都是可以综合的，而repeat和while往往是不可综合的，因此在自己编写代码的时，如果需要生成可以综合的代码，尽量使用for语句来实现循环。但是，正如上面所说的一样，综合出来的效率不一定很高，应该谨慎使用。</p>
<h3 id="verilog-hdl的设计层次与风格">Verilog HDL的设计层次与风格
</h3><p>在Verilog HDL中，可以使用不同的方式来进行电路的设计，有的时候也会给初学者很大的困扰。因为语言有很大的灵活性，对于相同的电路可以有不同的设计方法。这种灵活性可能会对初学者来说不太好掌握。下面就通过一个1位全加器的简单例子来说明在Verilog HDL中的不同的设计层次与设计方法。</p>
<p>1位的全加器的输入包括1位的低位进位cin，两个一位的输入信号a和b，输出则包括了一个当前位的和sum以及向高位的进位cout。全加器的电路图可以直接从1位全加器的真值表中获得，大部分的数字电路以及组成原理的教科书都有1位全加器的例子，可做参考。从1位全加器的真值表可以获得1位全加器的逻辑表达式：</p>
<p>CarryOut = (¬A<em>B</em>CarryIn)+(A*¬B<em>CarryIn)+(A</em>B*¬CarryIn)+(A<em>B</em>CarryIn)</p>
<p>=(B<em>CarryIn)+(A</em>CarryIn)+(A*B)</p>
<p>Sum = (¬A*¬B<em>CarryIn) + (¬A</em>B*¬CarryIn) + (A*¬B*¬CarryIn) +（A<em>B</em>CarryIn)</p>
<p>当然，上面已经完成了一个一位全加器的设计，并且已经设计出了电路。也就是说，真正的工作已经完成了，这实际上就是传统的硬件设计方法。作为例子，在这里首先把一个已经实现的电路绘制出来，然后再逐步讨论使用Verilog HDL进行不同的描述。目的就是展示出真正的硬件之后，再展示不同的描述，用以说明硬件与对应的描述之间的关联。</p>
<p>在上述的电路中，使用了三个非门（not），四个3输入的与门（and），三个2输入的与门（and），一个4输入的或门（or），一个3输入的或门（or）。这里的非门，与门和或门都是Verilog HDL中的内置的门电路，可以直接使用。这样，可以将上述电路中的每一条线进行命名，然后就可以直接构造出Verilog HDL的结构描述（调用门元件）。当然，如果是直接是输入线，就不必命名了，使用输入的名称即可，同理对于输出线可以使用输出的名称。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//1位全加器的门级结构描述
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">full_adder1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">a_n</span><span class="p">,</span> <span class="n">b_n</span><span class="p">,</span> <span class="n">cin_n</span><span class="p">,</span> <span class="n">sum_p1</span><span class="p">,</span><span class="n">sum_p2</span><span class="p">,</span><span class="n">sum_p3</span><span class="p">,</span><span class="n">sum_p4</span><span class="p">,</span> <span class="n">cout_p1</span><span class="p">,</span> <span class="n">cout_p2</span><span class="p">,</span> <span class="n">cout_p3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">not</span><span class="p">(</span><span class="n">a_n</span><span class="p">,</span><span class="n">a</span><span class="p">),(</span><span class="n">b_n</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="n">cin_n</span><span class="p">,</span><span class="n">cin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">and</span><span class="p">(</span><span class="n">sum_p1</span><span class="p">,</span><span class="n">a_n</span><span class="p">,</span><span class="n">b_n</span><span class="p">,</span><span class="n">cin</span><span class="p">),(</span><span class="n">sum_p2</span><span class="p">,</span><span class="n">a_n</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin_n</span><span class="p">),(</span><span class="n">sum_p3</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b_n</span><span class="p">,</span><span class="n">cin_n</span><span class="p">),(</span><span class="n">sum_p4</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">),(</span><span class="n">cout_p1</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">),(</span><span class="n">cout_p2</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">cin</span><span class="p">),(</span><span class="n">cout_p3</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">or</span><span class="p">(</span><span class="n">sum</span><span class="p">,</span><span class="n">sum_p1</span><span class="p">,</span><span class="n">sum_p2</span><span class="p">,</span><span class="n">sum_p3</span><span class="p">,</span><span class="n">sum_p4</span><span class="p">),(</span><span class="n">cout</span><span class="p">,</span><span class="n">cout_p1</span><span class="p">,</span><span class="n">cout_p2</span><span class="p">,</span><span class="n">cout_p3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，上述1位全加器的门级结构描述直接描述了各个门之间是如何连线的。由于是文本文件，因此连线不像图形那么直观。但是，从代码中的各个信号线的命名，以及对应于命名完成的信号线作为门级的调用参数来看，各个门原件的连线就比较清楚了。门级结构描述虽然不是最底层的描述（比如直接用晶体管搭建），但是已经非常接近底层的描述，可以被直接综合出来，使用元件进行直接映射即可。但是，门级结构描述的缺点也很明显，要求用户自行完成门级的设计，直接映射到硬件。这种方法一般用于设计比较简单的电路，或者设计非常高效工作的电路，方便综合器直接进行综合。当然，这里的门级结构描述还有一个作用，即其结构描述的方式可用于通过部分的逻辑电路模块来构造更加大型的电路模块。这个等讨论完其它两种描述之后再回顾一下会更加清楚。</p>
<p>门级结构描述虽然方便了底层的综合器，但是对于编程来说不太方便，开发者希望能够进行更加高层的设计。一个选择就是将上述的逻辑表达式直接写到程序里面这就是数据流描述的方法。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//1位全加器的数据流描述
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">full_adder1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">assign</span> <span class="n">sum</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">a</span><span class="o">&amp;~</span><span class="n">b</span><span class="o">&amp;</span><span class="n">cin</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="o">~</span><span class="n">a</span><span class="o">&amp;</span><span class="n">b</span><span class="o">&amp;~</span><span class="n">cin</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;~</span><span class="n">b</span><span class="o">&amp;~</span><span class="n">cin</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;</span><span class="n">b</span><span class="o">&amp;</span><span class="n">cin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">assign</span> <span class="n">cout</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">&amp;</span><span class="n">cin</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;</span><span class="n">cin</span><span class="p">)</span><span class="o">|</span><span class="p">(</span><span class="n">a</span><span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>这里的数据流描述方法，说明的就是在组合逻辑中，输出是如何随着输入数据的变化而变化，使用的是持续赋值语句assign。这些持续赋值语句说明了数据流的变化情况以及它们之间的逻辑关系。可以看到，持续赋值语句的抽象层次要比前面的门级结构描述更加抽象。只要有了逻辑表达式关系，直接翻译为Verilog HDL中的运算符即可，而不用仔细考虑底层的门电路构成。但是，数据流描述的抽象层次还不是很高，因为已经很难从给出的数据流中看到这是一个1位的全加器。实际上，对于复杂的硬件逻辑设计来说，使用行为级描述更为妥当，即直接描述出硬件所需要完成的功能，而不需要考虑这些硬件具体是如何实现的。具体如何实现交给EDA综合软件去做。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//1位全加器的行为级描述
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">full_adder1</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="kt">reg</span> <span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@</span><span class="o">*</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span><span class="n">cout</span><span class="p">,</span><span class="n">sum</span><span class="p">}</span><span class="o">=</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="o">+</span><span class="n">cin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>从行为级描述中完全看不到最终的电路是怎样使用元件以及怎样布线的，但是这个程序非常简单明了。这对于开发人员来说极为方便，直接能够看出是一个全加器，因为这一段程序完整的描述了一个全加器所需要完成的功能。</p>
<p>上面的结构级描述，数据流级描述以及行为级描述就是Verilog HDL开发过程中可以使用的三种不同层次的对于硬件的描述方法。结构级描述直接描述了硬件电路的结构，最为具体，但是不够抽象。数据流描述更加接近传统的逻辑设计，抽象程度中等。行为级描述只需要抽象描述一个硬件的功能单元完成什么样的功能即可，不需要说明硬件是如何构造的，最为抽象。在实际的设计过程中，这三种方式可以互相混合使用，针对不同的电路可以选择不同的描述方式。</p>
<p>在设计更加大型的硬件电路的时候，使用结构级描述是必不可少的。在前面的例子中，已经看到是如何通过调用门级的基本逻辑单元来完成全加器的功能。这样的方法在设计更加大型的电路中也是相同的。可以设计一些小型的电路模块，然后通过结构的描述来设计出规模更大的电路。下面就通过设计4位的加法器来说明结构描述在设计大型电路时候的作用。</p>
<p>通过对其中的信号进行命名，可以通过结构描述的方式来描述上述的电路。实际上，这里需要命名的信号就是进位到前一级的进位，可以分别命名为cin1，cin2，cin3。上述电路的描述如下。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">//1位全加器的行为级描述
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">full_adder4</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cin</span><span class="p">,</span><span class="n">sum</span><span class="p">,</span><span class="n">cout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="n">cin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span><span class="n">sum</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="n">cout</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">full_adder1</span> <span class="n">a0</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="n">cin</span><span class="p">,</span><span class="n">sum</span><span class="p">[</span><span class="mh">0</span><span class="p">],</span><span class="n">cin1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">full_adder1</span> <span class="n">a1</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="n">cin1sum</span><span class="p">[</span><span class="mh">1</span><span class="p">],</span><span class="n">cin2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">full_adder1</span> <span class="n">a2</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="n">cin2sum</span><span class="p">[</span><span class="mh">2</span><span class="p">],</span><span class="n">cin3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">full_adder1</span> <span class="n">a3</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="n">cin3sum</span><span class="p">[</span><span class="mh">3</span><span class="p">],</span><span class="n">cout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>可以看到，这里的结构级描述与之前的门级结构描述在形式上是完全一样的。例 17.12门级结构描述调用的是语言内建的元件，但是在这里调用的是开发者自己的模块。同时，在这里也看到了调用的另外一种形式，即可以对每一次调用进行命名，分别命名为a0, a1, a2, a3。</p>
<p>到现在为止，基本上对于Verilog HDL的编程语言进行了一个基本的介绍。当然，这里介绍的是Verilog HDL中的最基本的内容，希望能够帮助读者对Verilog HDL这样一个语言有一个最基本的了解。在实际进行硬件设计的时候，最基本的方法还是自顶向下的方法，对硬件的总体先分成多个互相独立的模块，然后定义模块之间的连线关系。之后，每一个独立的模块可以进行分别设计，连线关系即是它们之间的接口。最终完成的硬件通过结构描述的方式将设计完成的模块连接在一起。</p>
<h3 id="编程建议与经验">编程建议与经验
</h3><p>下面的内容与Verilog语言的语法不直接相关，但是会讨论一些经验以及常见的错误。这里的一些常见错误同学平时也会碰到，建议先阅读理解大概的含义，在具体编程碰到问题的时候也可以返回本节查看与理解。也注意多与同学讨论，少走弯路，减少调试难度。另外，一些具体实验中可能碰到的困难与错误已经列举在前面的实验提示部分。</p>
<p>计算机组成原理的实验是硬件实验，使用的是硬件描述语言Verilog。做实验之前一定要首先熟悉一下Verilog硬件描述语言的语法以及惯用的方法。惯用的方法可以从例子中学习。当然，编写正确代码也需要经验。Verilog代码是硬件描述语言，这个跟软件的代码语言完全不同，不能想当然从软件的角度去思考。Verilog只是描述硬件模块应该达到的功能，但是没有描述内部的结构，不能直接说明内部是如何的。这里关键的一点是所有的硬件模块都是并行执行的，是信号从输入到输出的传递的过程。除了Verilog的语法之外，下面的一些与语言相关的提示需要大家注意一下，会有一些帮助。</p>
<p><strong>`default_nettype none</strong></p>
<p>`default_nettype none 这是建议的做法。在Verilog中，所有没有被定义的标记label都被默认认为是wire类型的。但是，这种默认的行为有的是非常危险的，比如在信号名字上出现拼写错误不会被探测出来。因此，建议在所有的源文件的开始加上这一句，取消默认行为。</p>
<p><strong>锁相环电路</strong></p>
<p>PLL是FPGA上专用的时钟生成模块，内部是模拟电路。在启动时需要一段时间才能进入稳定状态，所以有个locked信号输出，表示它稳定了。具体的可以参考前面关于锁相环电路的讨论。</p>
<p><strong>调时序：</strong></p>
<p>调时序：不同模块之间，由于寄存器的关系，会有相位差，然后需要增加几个空的状态机节拍。哪个path太长了就加寄存器打一拍。</p>
<p><strong>阻塞赋值语句和非阻塞赋值语句：</strong></p>
<p>关于=和&lt;=：一般来说，组合逻辑用=，时序逻辑用&lt;=。但是实际上wire和reg仅仅是语法层面的东西，assign的左值必须是wire，always里的左值必须是reg，否则综合就会报错。最终是否综合成触发器，是根据有没有时钟信号决定的。综合器怎么知道哪个是时钟信号呢？通过posedge的描述方法可以知道对应的模块里面需要响应正边沿（posedge）或者是负边沿（negedge），从而会综合出触发器。</p>
<p>在Verilog的语法上，阻塞的过程赋值语句=，非阻塞的过程赋值语句&lt;=。在always过程里面的赋值语句被称为是过程赋值语句，一般用以对reg类型的变量进行赋值。过程赋值语句分为两种类型，一个是非阻塞赋值语句（&lt;=），一个是阻塞赋值语句（=）。它们之间的区别是：</p>
<p>1）非阻塞non-blocking赋值语句（&lt;=）在赋值语句出现的地方不是立即发生的，而是等到整个过程块结束的时候才发生。由于不是立即发生的，在过程内的描述中，仿佛这条语句不存在一样，因此被称为是非阻塞的。只是在过程的最后会执行所有的非阻塞赋值语句，在这个执行的过程中，所有的右值会维持原来的值不变。</p>
<p>2）阻塞blocking赋值语句（=）在赋值语句出现的地方就立即完成赋值操作，左值立刻发生变化。一个块语句中存在多条阻塞赋值语句的话，这些阻塞赋值语句会按照先后顺序关系，一条一条的执行，前面的赋值语句没有执行完，后面的赋值语句不会执行。</p>
<p><strong>程序的可读性：</strong></p>
<p>写Verilog的代码和写软件应用程序的代码一样，有一件事情需要特别注意，就是提高程序的可读性，增加程序的可维护性。在选择信号名称的时候需要按照名称选择的惯例，有一些名称是常用的，按照其惯常的用法就可以了，不要改变其名字的用法。下面是一些名字使用的惯例，同学们应当遵守来提高自己程序的可读性。</p>
<p>_i, _o，分别代表一个模块的输入信号和输出信号。</p>
<p>n或者_n为后缀，表明这个信号是0使能。</p>
<p>clk，clock时钟信号，后面或者前面接上频率，可以显示时钟信号的频率。</p>
<p>rst，reset重置信号，使得信号可以重置，一般在重置响应中写入状态机的初值。</p>
<p>we，write enable信号，对应于模块的写入使能。</p>
<p>oe，output entable信号，对应于模块的读取使能。</p>
<p>ce，chip enable，对应于模块的总体使能信号。上述的信号几乎在所有的模块中都会有。（注意信号是正向的还是反向的，即1使能还是0使能。在说明书中，0使能会在信号名称的上面带有横线。）</p>
<p>select，sel，这个信号一般用于对芯片的选择。</p>
<p>其它的信号也会有惯例使用的情况，大家在平时的时候可以多注意学习。</p>
<p><strong>代码检查工具：</strong></p>
<p>下面的网址中有一些Verilog的工具可以供大家参考。</p>
<p><a class="link" href="https://www.veripool.org/"  target="_blank" rel="noopener"
    >https://www.veripool.org/</a>

</p>
<p>verilator &ndash;lint-only -Wall [source_files.v]&hellip; 可以帮助做一些检查。</p>
<p><strong>一些特殊的语法点：</strong></p>
<p>ram_address = pc[2+:21];</p>
<p>含义就是从第2位开始的21位，就是2:22，就是把最后两位去掉。</p>
<p>或者写成pc[22:2]也是一样的。</p>
<p><strong>case语句可能出现错误的情况：</strong></p>
<p>在使用case的时候，一定要注意把所有的信号在所有的情况下写全了，要不然有一些信号就没有定义，会造成错误。或者可以灵活使用赋值语句，=，在过程最前面的时候先进行赋值。</p>
<p>下面的case代码块是正确的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">ram_we_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ram_address</span> <span class="o">=</span> <span class="mh">21&#39;h0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_FETCH:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">pc</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_MEM:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="o">~</span><span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">ex_val_o</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>下面的case语句代码块也是正确的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_FETCH:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">pc</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_MEM:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="o">~</span><span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">ex_val_o</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="mh">21&#39;h0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>但是下面的case语句代码块是错误的，为什么？（所有情况没有考虑完善）</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_FETCH:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">pc</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STATE_MEM:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="o">~</span><span class="n">mem_op_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="n">ex_val_o</span><span class="p">[</span><span class="mh">22</span><span class="o">:</span><span class="mh">2</span><span class="p">];</span> 
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_oe_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_we_n</span> <span class="o">=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">ram_address</span> <span class="o">=</span> <span class="mh">21&#39;h0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>always过程语句的敏感信号</strong></p>
<p>Verilog规定，always@(<em>)中的</em>是指该always块内的所有输入信号的变化为敏感列表，也就是仿真时只有当always@(*)块内的输入信号产生变化，该块内描述的信号才会产生变化。</p>
<p><strong>Warning: empty statement in seqential block</strong></p>
<p>如果两个分号放在一起的话&quot;;;&quot;&quot;，就会出现这个警告。删掉一个分号即可。这里一个容易出现的错误是在信号常数定义<code>define的时候，不小心在信号后面跟了一个分号，例如</code>define OP_ADD 4&rsquo;h9; 这里多了一个分号。在模块代码里面直接使用的时候就会出现上面的情况。</p>
<h2 id="verilog的实战引入">Verilog的实战引入
</h2><p>为了解verilog的语法，此处通过实战引入</p>
<h3 id="示例程序4位二进制计数器">示例程序：4位二进制计数器
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// 模块声明，定义模块名和参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">counter</span> <span class="p">#(</span>
</span></span><span class="line"><span class="cl">    <span class="k">parameter</span> <span class="n">WIDTH</span> <span class="o">=</span> <span class="mh">4</span>  <span class="c1">// 参数定义，计数器的位宽
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">clk</span><span class="p">,</span>       <span class="c1">// 输入信号：时钟
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">input</span> <span class="kt">wire</span> <span class="n">rst_n</span><span class="p">,</span>     <span class="c1">// 输入信号：同步复位（低有效）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">input</span> <span class="kt">wire</span> <span class="n">en</span><span class="p">,</span>        <span class="c1">// 输入信号：使能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">output</span> <span class="kt">reg</span> <span class="p">[</span><span class="n">WIDTH</span><span class="o">-</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span>  <span class="c1">// 输出信号：计数值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 内部信号声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="n">rst</span> <span class="o">=</span> <span class="o">~</span><span class="n">rst_n</span><span class="p">;</span>  <span class="c1">// 使用wire类型定义内部复位信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// 计数逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">&lt;=</span> <span class="mh">0</span><span class="p">;</span>  <span class="c1">// 复位时计数器清零
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">end</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">en</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">count</span> <span class="o">&lt;=</span> <span class="n">count</span> <span class="o">+</span> <span class="mh">1</span><span class="p">;</span>  <span class="c1">// 使能时计数器加一
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 初始块，用于仿真时初始化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>语法规则详解</strong></p>
<ol>
<li>
<p><strong>模块声明 (<code>module</code>)</strong>:</p>
<p><code>module counter</code>: 定义一个名为 <code>counter</code> 的模块。<code>#(parameter WIDTH = 4)</code>: 定义参数 <code>WIDTH</code>，默认值为4，用于设置计数器的位宽。这使得模块更具通用性。</p>
</li>
<li>
<p><strong>端口声明</strong>:</p>
<ul>
<li><code>input wire clk</code>: 定义输入端口 <code>clk</code>，类型为 <code>wire</code>，表示时钟信号。</li>
<li><code>input wire rst_n</code>: 定义输入端口 <code>rst_n</code>，类型为 <code>wire</code>，表示同步复位信号，低有效。</li>
<li><code>input wire en</code>: 定义输入端口 <code>en</code>，类型为 <code>wire</code>，表示计数使能信号。</li>
<li><code>output reg [WIDTH-1:0] count</code>: 定义输出端口 <code>count</code>，类型为 <code>reg</code>，位宽为 <code>WIDTH</code>，用于存储计数值。</li>
</ul>
</li>
<li>
<p><strong>内部信号 (<code>wire</code>)</strong>: <code>wire rst = ~rst_n;</code>: 定义内部信号 <code>rst</code>，通过取反 <code>rst_n</code> 得到高有效的复位信号。</p>
</li>
<li>
<p><strong>行为描述 (<code>always</code> 块)</strong>:</p>
<ul>
<li><code>always @(posedge clk or posedge rst)</code>: 定义一个 <code>always</code> 块，敏感于 <code>clk</code> 的上升沿和 <code>rst</code> 的上升沿。</li>
<li>在always块内部：
<ul>
<li><code>if (rst)</code>: 如果复位信号有效，则将 <code>count</code> 清零。</li>
<li><code>else if (en)</code>: 否则，如果使能信号有效，则将 <code>count</code> 加一。</li>
</ul>
</li>
<li>使用非阻塞赋值 <code>&lt;=</code> 来描述时序逻辑，确保在时钟边沿正确更新信号。</li>
</ul>
</li>
<li>
<p><strong>初始块 (<code>initial</code> 块)</strong>:<code>initial begin count = 0; end</code>: 在仿真开始时，将 <code>count</code> 初始化为0。这在实际硬件中通常由复位信号处理，但在仿真中有助于明确初始状态。
initial过程语句不带出发条件且仅执行一次。initial语句通常用于仿真模块中对激励向量的描述，或者用于给寄存器变量赋初值。它是面向模拟仿真的过程语句，通常不能被逻辑综合工具支持。</p>
</li>
<li>
<p><strong>数据类型</strong>:</p>
<ul>
<li><code>wire</code>: 用于连续赋值，表示信号之间的连接。</li>
<li><code>reg</code>: 用于在 <code>always</code> 块中赋值，表示需要在时序逻辑中存储值的信号。</li>
</ul>
</li>
</ol>
<h3 id="4位二进制计数器testbench">4位二进制计数器testbench
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// counter_tb.v
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">counter_tb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 输入信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">reg</span> <span class="n">clk</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="n">rst_n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="n">en</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 输出信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">wire</span> <span class="p">[</span><span class="mh">3</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 实例化被测模块
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">counter</span> <span class="n">uut</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">clk</span><span class="p">(</span><span class="n">clk</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">rst_n</span><span class="p">(</span><span class="n">rst_n</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">en</span><span class="p">(</span><span class="n">en</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 生成波形文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">$dumpfile</span><span class="p">(</span><span class="s">&#34;counter_tb.vcd&#34;</span><span class="p">);</span> <span class="c1">// 指定波形文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">$dumpvars</span><span class="p">(</span><span class="mh">0</span><span class="p">,</span> <span class="n">counter_tb</span><span class="p">);</span>     <span class="c1">// 记录所有信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 生成时钟信号，周期10个时间单位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">clk</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">forever</span> <span class="p">#</span><span class="mh">5</span> <span class="n">clk</span> <span class="o">=</span> <span class="o">~</span><span class="n">clk</span><span class="p">;</span> <span class="c1">// 每5个时间单位反转一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 生成复位和使能信号的任务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">task</span> <span class="n">reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">en</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">#</span><span class="mh">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">#</span><span class="mh">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endtask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">task</span> <span class="n">enable_count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">en</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="p">#</span><span class="mh">50</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">en</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endtask</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// Testbench 主过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 初始化信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">rst_n</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">en</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 调用复位任务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 启动计数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">enable_count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 再次复位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// 结束仿真
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">#</span><span class="mh">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">$finish</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 监控信号变化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">initial</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="nb">$monitor</span><span class="p">(</span><span class="s">&#34;Time=%0t | rst_n=%b | en=%b | count=%d&#34;</span><span class="p">,</span> <span class="nb">$time</span><span class="p">,</span> <span class="n">rst_n</span><span class="p">,</span> <span class="n">en</span><span class="p">,</span> <span class="n">count</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="示例程序交通信号灯控制">示例程序：交通信号灯控制
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="c1">// 顶层模块声明
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">traffic_light_controller</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="kt">wire</span> <span class="n">clk</span><span class="p">,</span>          <span class="c1">// 时钟信号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">input</span> <span class="kt">wire</span> <span class="n">rst_n</span><span class="p">,</span>        <span class="c1">// 复位信号，低有效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">output</span> <span class="kt">reg</span> <span class="n">red</span><span class="p">,</span>          <span class="c1">// 红灯输出
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">output</span> <span class="kt">reg</span> <span class="n">yellow</span><span class="p">,</span>       <span class="c1">// 黄灯输出
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">output</span> <span class="kt">reg</span> <span class="n">green</span>         <span class="c1">// 绿灯输出
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 状态定义 using localparam
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">localparam</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">    <span class="n">RED_STATE</span>    <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">GREEN_STATE</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">YELLOW_STATE</span> <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 当前状态和下一个状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">,</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 连续赋值使用 assign
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">wire</span> <span class="n">rst</span> <span class="o">=</span> <span class="o">~</span><span class="n">rst_n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 状态转移逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">RED_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 下一个状态的组合逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">RED_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_state</span> <span class="o">=</span> <span class="n">GREEN_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">GREEN_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_state</span> <span class="o">=</span> <span class="n">YELLOW_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">YELLOW_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_state</span> <span class="o">=</span> <span class="n">RED_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">next_state</span> <span class="o">=</span> <span class="n">RED_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 输出逻辑
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 默认所有灯关闭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">red</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">yellow</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">green</span> <span class="o">=</span> <span class="mh">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">RED_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">red</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">GREEN_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">green</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">YELLOW_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">yellow</span> <span class="o">=</span> <span class="mh">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>语法规则详解</strong></p>
<ol>
<li>
<p><strong><code>localparam</code></strong>:</p>
<p>使用 <code>localparam</code> 定义本地参数，用于状态编码，避免在模块外部被修改。例如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">localparam</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> 
</span></span><span class="line"><span class="cl">    <span class="n">RED_STATE</span>    <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">GREEN_STATE</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">YELLOW_STATE</span> <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>assign</code> 语句</strong>:</p>
<p>用于连续赋值，适用于组合逻辑。在本例中，将<code>rst</code>定义为<code>rst_n</code>的反转：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">rst</span> <span class="o">=</span> <span class="o">~</span><span class="n">rst_n</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>always @(\*)</code> 块</strong>:</p>
<p><code>always @(*)</code> 表示组合逻辑块，自动包含所有右边信号作为敏感信号。用于定义下一个状态和输出逻辑：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 组合逻辑内容
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong><code>case</code> 语句</strong>:</p>
<p>用于多分支条件选择，类似于编程语言中的 <code>switch</code> 语句。在状态转移和输出逻辑中使用：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RED_STATE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">next_state</span> <span class="o">=</span> <span class="n">GREEN_STATE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 其他状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">default</span><span class="o">:</span><span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//default分支:在case语句中使用default处理未定义的情况
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    	<span class="c1">//....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">endcase</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>组合逻辑与时序逻辑的分离</strong>:</p>
<p>使用不同的 <code>always</code> 块分别处理时序逻辑（状态转移）和组合逻辑（下一个状态及输出）。</p>
</li>
<li>
<p><strong>信号驱动类型</strong>:</p>
<p><code>reg</code> 类型用于在 <code>always</code> 块中赋值的信号，如 <code>current_state</code> 和输出信号 <code>red</code>、<code>yellow</code>、<code>green</code>。<code>wire</code> 类型用于连续赋值的信号，如内部复位信号 <code>rst</code>。</p>
</li>
</ol>
<h3 id="示例程序uart的收发">示例程序：UART的收发
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="no">`timescale</span> <span class="mh">1</span><span class="n">ns</span> <span class="o">/</span> <span class="mh">1</span><span class="n">ps</span>
</span></span><span class="line"><span class="cl"><span class="c1">//该模块实现了一个UART（通用异步收发传输器）接收器，用于接收串行数据并将其转换为并行数据。
</span></span></span><span class="line"><span class="cl"><span class="c1">//主要功能包括检测起始位、接收数据位、检测停止位，并在接收完成后输出有效信号和接收到的数据。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">uart_recv</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span>               <span class="n">clk</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span>               <span class="n">rst</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span>               <span class="n">din</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="kt">reg</span>          <span class="n">valid</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>    <span class="n">data</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">IDLE</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">START</span> <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">DATA</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">STOP</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b11</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">baud_counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">=</span> <span class="mh">14</span><span class="mi">&#39;d10416</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">baud_tick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">bit_cnt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_reg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="n">din_r1</span><span class="p">,</span> <span class="n">din_r2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">rx_data</span> <span class="o">=</span> <span class="n">din_r2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">din_r1</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">din_r2</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">din_r1</span> <span class="o">&lt;=</span> <span class="n">din</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">din_r2</span> <span class="o">&lt;=</span> <span class="n">din_r1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">assign</span> <span class="n">baud_tick</span> <span class="o">=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">BAUD_COUNT_MAX</span> <span class="o">&gt;&gt;</span> <span class="mh">1</span><span class="p">)</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">BAUD_COUNT_MAX</span> <span class="o">&gt;&gt;</span> <span class="mh">1</span><span class="p">)</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">baud_counter</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nl">IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">START:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> <span class="o">?</span> <span class="n">DATA</span> <span class="o">:</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">DATA:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span> <span class="o">&amp;&amp;</span> <span class="n">bit_cnt</span> <span class="o">==</span> <span class="mh">3</span><span class="mi">&#39;d7</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STOP:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>  <span class="c1">// Sample stop bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">!=</span> <span class="n">DATA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="n">bit_cnt</span> <span class="o">+</span> <span class="mh">3</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">DATA</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">rx_data</span><span class="p">,</span> <span class="n">data_reg</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">1</span><span class="p">]};</span>  
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">STOP</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">&lt;=</span> <span class="n">data_reg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span><span class="line"><span class="cl"><span class="c1">//该模块实现了一个UART发送器，用于将并行数据转换为串行数据进行发送。
</span></span></span><span class="line"><span class="cl"><span class="c1">//主要功能包括发送起始位、数据位和停止位，并在发送完成后返回到空闲状态。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">module</span> <span class="n">uart_send</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="k">input</span>        <span class="n">clk</span><span class="p">,</span>        
</span></span><span class="line"><span class="cl">    <span class="k">input</span>        <span class="n">rst</span><span class="p">,</span>       
</span></span><span class="line"><span class="cl">    <span class="k">input</span>        <span class="n">valid</span><span class="p">,</span>      
</span></span><span class="line"><span class="cl">    <span class="k">input</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span>  <span class="n">data</span><span class="p">,</span>      
</span></span><span class="line"><span class="cl">    <span class="k">output</span> <span class="kt">reg</span>   <span class="n">dout</span>       
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">IDLE</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b00</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">START</span> <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b01</span><span class="p">;</span>   
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">DATA</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b10</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">STOP</span>  <span class="o">=</span> <span class="mh">2</span><span class="mb">&#39;b11</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">baud_counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">localparam</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">=</span> <span class="mh">14</span><span class="mi">&#39;d10416</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">    <span class="kt">wire</span> <span class="n">baud_tick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">bit_cnt</span><span class="p">;</span>      
</span></span><span class="line"><span class="cl">    <span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_reg</span><span class="p">;</span>     
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">assign</span> <span class="n">baud_tick</span> <span class="o">=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">!=</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">)</span> <span class="o">?</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span> <span class="o">:</span> <span class="n">baud_counter</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span>
</span></span><span class="line"><span class="cl">            <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">valid</span> <span class="o">&amp;&amp;</span> <span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">DATA</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="n">bit_cnt</span> <span class="o">+</span> <span class="mh">3</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nl">IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">START:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">DATA:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span> <span class="o">&amp;&amp;</span> <span class="n">bit_cnt</span> <span class="o">==</span> <span class="mh">3</span><span class="mi">&#39;d7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STOP:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">else</span>
</span></span><span class="line"><span class="cl">                    <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">end</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="nl">IDLE:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nl">START:</span> <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="nl">DATA:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="n">data_reg</span><span class="p">[</span><span class="n">bit_cnt</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">                <span class="nl">STOP:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">default</span><span class="o">:</span> <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">endmodule</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>设计思想：两者均采用有限状态机（FSM）的设计方法，定义了四个状态：<code>IDLE</code>（空闲）、<code>START</code>（起始）、<code>DATA</code>（数据）、<code>STOP</code>（停止）。这种设计有助于清晰地划分不同的操作阶段，便于管理和扩展。</p>
<p>时钟生成与计数器：</p>
<ul>
<li><code>baud_counter</code>：用于生成波特率时钟脉冲。<code>BAUD_COUNT_MAX</code> 定义了一个波特周期的计数值（10416），对应于特定的波特率（如9600波特，假设时钟频率为100MHz）。</li>
<li><code>baud_tick</code>：当 <code>baud_counter</code> 计数到0时产生一个波特率脉冲，用于状态转换和数据采样。</li>
</ul>
<p>复位逻辑：在复位信号有效时，将状态机置于 <code>IDLE</code> 状态，并重置相关计数器和寄存器。</p>
<p><code>uart_recv</code> 模块详细分析</p>
<p><strong>信号声明</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">baud_counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">localparam</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">=</span> <span class="mh">14</span><span class="mi">&#39;d10416</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">baud_tick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">bit_cnt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_reg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="n">din_r1</span><span class="p">,</span> <span class="n">din_r2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">rx_data</span> <span class="o">=</span> <span class="n">din_r2</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>状态相关信号</strong>：</p>
<ul>
<li><code>current_state</code>：当前状态。</li>
<li><code>next_state</code>：下一个状态。</li>
</ul>
<p><strong>波特率计数器</strong>：</p>
<ul>
<li><code>baud_counter</code>：用于生成波特率脉冲。</li>
<li><code>BAUD_COUNT_MAX</code>：波特率计数的最大值（10416）。</li>
<li><code>baud_tick</code>：当 <code>baud_counter</code> 为0时产生脉冲。</li>
</ul>
<p><strong>数据相关信号</strong>：</p>
<ul>
<li><code>bit_cnt</code>：数据位计数器，记录当前接收的数据位。</li>
<li><code>data_reg</code>：临时存储接收的数据位。</li>
<li><code>data</code>：输出的并行数据。</li>
</ul>
<p><strong>输入信号去抖动</strong>：</p>
<ul>
<li><code>din_r1</code>, <code>din_r2</code>：用于同步和去抖动串行输入信号 <code>din</code>。</li>
<li><code>rx_data</code>：同步后的输入信号。</li>
</ul>
<p><strong>输入信号同步</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">din_r1</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">din_r2</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">din_r1</span> <span class="o">&lt;=</span> <span class="n">din</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">din_r2</span> <span class="o">&lt;=</span> <span class="n">din_r1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>功能</strong>：将异步的串行输入 <code>din</code> 同步到本地时钟域，减少亚稳态问题。</li>
<li><strong>初始状态</strong>：在复位时，将 <code>din_r1</code> 和 <code>din_r2</code> 设为1（空闲状态，UART线默认为高电平）。</li>
</ul>
<p><strong>波特率计数器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">baud_tick</span> <span class="o">=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">BAUD_COUNT_MAX</span> <span class="o">&gt;&gt;</span> <span class="mh">1</span><span class="p">)</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">BAUD_COUNT_MAX</span> <span class="o">&gt;&gt;</span> <span class="mh">1</span><span class="p">)</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>  
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">baud_counter</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>当在 <code>IDLE</code> 状态时，计数器初始化为 <code>BAUD_COUNT_MAX / 2 - 1</code>，以便在检测到起始位后，等待半个波特周期后开始采样，确保采样在中间位置。</li>
<li>在其他状态，计数器在每个波特周期递减，直到达到0时产生 <code>baud_tick</code>，并重新加载计数值。</li>
</ul>
<p><strong>状态寄存器更新</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>功能</strong>：在每个时钟上升沿或复位信号有效时，更新当前状态。</li>
</ul>
<p><strong>下一个状态逻辑</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span><span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">START:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="p">(</span><span class="o">!</span><span class="n">rx_data</span><span class="p">)</span> <span class="o">?</span> <span class="n">DATA</span> <span class="o">:</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">DATA:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span> <span class="o">&amp;&amp;</span> <span class="n">bit_cnt</span> <span class="o">==</span> <span class="mh">3</span><span class="mi">&#39;d7</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STOP:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>  <span class="c1">// Sample stop bit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>IDLE：
<ul>
<li>等待检测到起始位（<code>!rx_data</code>）。</li>
<li>检测到起始位后，进入 <code>START</code> 状态。</li>
</ul>
</li>
<li>START：
<ul>
<li>等待一个波特周期（<code>baud_tick</code>），确认起始位的稳定性。</li>
<li>如果仍然检测到低电平，进入 <code>DATA</code> 状态；否则，返回 <code>IDLE</code>。</li>
</ul>
</li>
<li>DATA：
<ul>
<li>每个波特周期采样一个数据位。</li>
<li>计数器达到7（接收完8位数据）后，进入 <code>STOP</code> 状态；否则，继续 <code>DATA</code> 状态。</li>
</ul>
</li>
<li>STOP：
<ul>
<li>等待一个波特周期采样停止位。</li>
<li>采样完成后，返回 <code>IDLE</code> 状态。</li>
</ul>
</li>
<li>default：
<ul>
<li>遇到未定义状态时，返回 <code>IDLE</code>。</li>
</ul>
</li>
</ul>
<p><strong>数据位计数器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">!=</span> <span class="n">DATA</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="n">bit_cnt</span> <span class="o">+</span> <span class="mh">3</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在 <code>DATA</code> 状态下，每个波特周期递增 <code>bit_cnt</code>。</li>
<li>在其他状态（<code>IDLE</code>、<code>START</code>、<code>STOP</code>）复位计数器。</li>
</ul>
<p><strong>数据寄存器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">DATA</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="p">{</span><span class="n">rx_data</span><span class="p">,</span> <span class="n">data_reg</span><span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">1</span><span class="p">]};</span>  
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在 <code>DATA</code> 状态下，每个波特周期将接收到的位 <code>rx_data</code> 右移并存入 <code>data_reg</code>。</li>
<li>实现串行到并行的数据转换。</li>
</ul>
<p><strong>输出信号生成</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">STOP</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">&lt;=</span> <span class="n">data_reg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span> <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="n">valid</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在 <code>STOP</code> 状态且 <code>baud_tick</code> 时，表示数据接收完成，设置 <code>valid</code> 为高，并将接收到的数据 <code>data_reg</code> 赋值给输出 <code>data</code>。</li>
<li>其他时间，<code>valid</code> 保持低。</li>
</ul>
<p><code>uart_recv</code> 模块通过四状态的有限状态机，实现了UART接收的基本功能，包括检测起始位、采样数据位、验证停止位，并在接收完成后输出有效信号和接收到的数据。关键设计点包括输入信号同步、波特率生成、状态机设计和数据采样等。</p>
<hr>
<p><code>uart_send</code> 模块详细分析</p>
<p><strong>信号声明</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">current_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">1</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">13</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">baud_counter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">localparam</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">=</span> <span class="mh">14</span><span class="mi">&#39;d10416</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl"><span class="kt">wire</span> <span class="n">baud_tick</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">2</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">bit_cnt</span><span class="p">;</span>      
</span></span><span class="line"><span class="cl"><span class="kt">reg</span> <span class="p">[</span><span class="mh">7</span><span class="o">:</span><span class="mh">0</span><span class="p">]</span> <span class="n">data_reg</span><span class="p">;</span>     
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>状态相关信号</strong>：
<ul>
<li><code>current_state</code>：当前状态。</li>
<li><code>next_state</code>：下一个状态。</li>
</ul>
</li>
<li><strong>波特率计数器</strong>：
<ul>
<li><code>baud_counter</code>：用于生成波特率脉冲。</li>
<li><code>BAUD_COUNT_MAX</code>：波特率计数的最大值（10416）。</li>
<li><code>baud_tick</code>：当 <code>baud_counter</code> 为0时产生脉冲。</li>
</ul>
</li>
<li><strong>数据相关信号</strong>：
<ul>
<li><code>bit_cnt</code>：数据位计数器，记录当前发送的数据位。</li>
<li><code>data_reg</code>：临时存储待发送的数据位。</li>
<li><code>dout</code>：串行数据输出。</li>
</ul>
</li>
</ul>
<p><strong>波特率计数器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">assign</span> <span class="n">baud_tick</span> <span class="o">=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">!=</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">baud_counter</span> <span class="o">==</span> <span class="mh">14</span><span class="mi">&#39;d0</span><span class="p">)</span> <span class="o">?</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span> <span class="o">:</span> <span class="n">baud_counter</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">baud_counter</span> <span class="o">&lt;=</span> <span class="n">BAUD_COUNT_MAX</span> <span class="o">-</span> <span class="mh">14</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在非 <code>IDLE</code> 状态下，计数器递减，直到达到0时产生 <code>baud_tick</code>，并重新加载计数值。</li>
<li>在 <code>IDLE</code> 状态，计数器保持在 <code>BAUD_COUNT_MAX - 1</code>，等待发送触发。</li>
</ul>
<p><strong>状态寄存器更新</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="n">current_state</span> <span class="o">&lt;=</span> <span class="n">next_state</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>功能</strong>：在每个时钟上升沿或复位信号有效时，更新当前状态。</li>
</ul>
<p><strong>数据寄存器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="mh">8</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">valid</span> <span class="o">&amp;&amp;</span> <span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data_reg</span> <span class="o">&lt;=</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在 <code>IDLE</code> 状态且 <code>valid</code> 为高时，将输入数据 <code>data</code> 载入 <code>data_reg</code>，准备发送。</li>
</ul>
<p><strong>数据位计数器</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">DATA</span> <span class="o">&amp;&amp;</span> <span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="n">bit_cnt</span> <span class="o">+</span> <span class="mh">3</span><span class="mi">&#39;d1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">current_state</span> <span class="o">==</span> <span class="n">IDLE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">bit_cnt</span> <span class="o">&lt;=</span> <span class="mh">3</span><span class="mi">&#39;d0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>在 <code>DATA</code> 状态下，每个波特周期递增 <code>bit_cnt</code>，记录当前发送的数据位。</li>
<li>在 <code>IDLE</code> 状态复位计数器。</li>
</ul>
<p><strong>下一个状态逻辑</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="o">*</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nl">IDLE:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">valid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">START:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">START</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">DATA:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span> <span class="o">&amp;&amp;</span> <span class="n">bit_cnt</span> <span class="o">==</span> <span class="mh">3</span><span class="mi">&#39;d7</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="nl">STOP:</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">baud_tick</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span>
</span></span><span class="line"><span class="cl">                <span class="n">next_state</span> <span class="o">=</span> <span class="n">STOP</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">end</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="n">next_state</span> <span class="o">=</span> <span class="n">IDLE</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">endcase</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>IDLE：
<ul>
<li>等待发送有效信号（<code>valid</code>）。</li>
<li>接收到 <code>valid</code> 后，进入 <code>START</code> 状态。</li>
</ul>
</li>
<li>START：
<ul>
<li>等待一个波特周期（<code>baud_tick</code>），然后进入 <code>DATA</code> 状态。</li>
</ul>
</li>
<li>DATA：
<ul>
<li>在每个波特周期发送一个数据位。</li>
<li>发送完第8位数据后，进入 <code>STOP</code> 状态。</li>
</ul>
</li>
<li>STOP：
<ul>
<li>等待一个波特周期采样停止位，然后返回 <code>IDLE</code> 状态。</li>
</ul>
</li>
<li>default：
<ul>
<li>遇到未定义状态时，返回 <code>IDLE</code>。</li>
</ul>
</li>
</ul>
<p><strong>串行数据输出逻辑</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-verilog" data-lang="verilog"><span class="line"><span class="cl"><span class="k">always</span> <span class="p">@(</span><span class="k">posedge</span> <span class="n">clk</span> <span class="k">or</span> <span class="k">posedge</span> <span class="n">rst</span><span class="p">)</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="n">rst</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span> <span class="k">begin</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="p">(</span><span class="n">current_state</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="nl">IDLE:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nl">START:</span> <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="nl">DATA:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="n">data_reg</span><span class="p">[</span><span class="n">bit_cnt</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="nl">STOP:</span>  <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">default</span><span class="o">:</span> <span class="n">dout</span> <span class="o">&lt;=</span> <span class="mh">1</span><span class="mb">&#39;b1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">endcase</span>
</span></span><span class="line"><span class="cl">    <span class="k">end</span>
</span></span><span class="line"><span class="cl"><span class="k">end</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><strong>IDLE</strong>：<code>dout</code> 保持高电平（UART空闲状态）。</li>
<li><strong>START</strong>：发送低电平起始位。</li>
<li><strong>DATA</strong>：按位发送数据，按照 <code>bit_cnt</code> 从 <code>data_reg</code> 中取出对应位。</li>
<li><strong>STOP</strong>：发送高电平停止位。</li>
<li><strong>default</strong>：默认保持高电平。</li>
</ul>
<p><code>uart_send</code> 模块通过四状态的有限状态机，实现了UART发送的基本功能，包括发送起始位、数据位和停止位。关键设计点包括数据寄存器加载、波特率生成、状态机设计和数据位发送等。</p>

</section>


    <footer class="article-footer">
    

    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            最后更新于 Nov 20, 2024 22:49 &#43;0800
        </span>
    </section></footer>




    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.body, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>
    
</article>

    

    

     
    
        
    

    <footer class="site-footer">

    <section class="copyright">
        &copy; 
        
        2024 echudet
    </section>
    
    <section class="powerby">
        


        <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>

        <script language="javascript"> 
            var now = new Date();
            function createtime(){
                now.setTime(now.getTime()+250);
                var grt= new Date("2024/11/10 00:00:00"); 
                days = (now - grt ) / 1000 / 60 / 60 / 24;
                dnum = Math.floor(days);
                hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum);
                hnum = Math.floor(hours);
                if(String(hnum).length ==1 ){hnum = "0" + hnum;}
                minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
                mnum = Math.floor(minutes);
                if(String(mnum).length ==1 ){mnum = "0" + mnum;}
                seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
                snum = Math.round(seconds);
                if(String(snum).length ==1 ){snum = "0" + snum;}

                document.getElementById("timeDate").innerHTML = "本站已稳定运行"+dnum+" 天 ";
                document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒<br>"
            }
            setInterval("createtime()",250); 
        </script> 

        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        
    
        
         
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
             
        
        

        共 710866 字 , 31 篇文章<br>使用 <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> 构建 <br />
        主题 <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.29.0">Stack</a></b> 由 <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> 设计
    </section>

</footer>



    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>


    </body>
</html>
